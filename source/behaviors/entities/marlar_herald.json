//bridge-file-version: #37
{
	"format_version": "1.19.20",
	"minecraft:entity": {
		"description": {
			"identifier": "zalcyan:marlar_herald",
			"is_spawnable": true,
			"is_summonable": true,
			"is_experimental": false,
			 "properties":{
			"zalcyan:gun_spark": { 
				"type": "bool", 
				 "default": true,
				"client_sync": true 
				},
			"zalcyan:shielded": { 
				"type": "bool", 
				 "default": false,
				"client_sync": true 
				},
			"zalcyan:equip_custom_shield": { 
				"type": "bool", 
				 "default": true,
				"client_sync": true 
				},
			"zalcyan:throw": { 
				"type": "bool", 
				 "default": false,
				"client_sync": true 
				}				
			 },
			 "scripts": {
				"animate": [
					"bridge_execute_commands",
					"shield_equip"
				]
			},
			"animations": {
				"bridge_execute_commands": "controller.animation.bridge_marlar_herald.execute_commands",
				"shield_equip": "controller.animation.bridge_marlar_herald.shield"
				
			}
		},
		"component_groups": {
			"shield_block": {
				"minecraft:behavior.delayed_attack": {
				"priority": 1,
					"attack_duration": 0.10,
					"attack_once": false,
					"cooldown_time": 10,
					"track_target": true,
					"require_complete_path": false,
					"random_stop_interval": 0,
					"reach_multiplier": 0.1,
					"speed_multiplier": 0.1,
					"hit_delay_pct": 0.5
				},
				"minecraft:attack": {
					"damage": 0
				},
				"minecraft:damage_sensor": {
					"triggers": [
						{
							"cause": "entity_attack",
							"deals_damage": false,
							"on_damage": {
								"event": "interact",
								"target": "self"
							}
						},
						{
							"cause": "projectile",
							"deals_damage": false,
							"on_damage": {
								"event": "interact",
								"target": "self"
							}
						},
						{
							"cause": "entity_explosion",
							"deals_damage": false,
							"on_damage": {
								"event": "interact",
								"target": "self"
							}
						},
						{
							"on_damage": {
								"event": "minecraft:event_spawn_dead",
								"target": "self",
								"filters": {
								"all_of": [
										{
											"test": "has_damage",
											"value": "fatal"
										}
									]
								}
							}
						}
					]
				},
				"minecraft:timer": {
					"looping": true,
					"time": [
						0.8,
						3.5
					],
					"time_down_event": {
						"event": "no_shield_block_event",
						"target": "self"
					}
				}
			},
			"no_shield_block": {
				"minecraft:damage_sensor": {
					"triggers": [
						{
							"on_damage": {
								"event": "minecraft:event_spawn_dead",
								"target": "self",
								"filters": {
								"all_of": [
										{
											"test": "has_damage",
											"value": "fatal"
										}
									]
								}
							}
						},
						{
							"on_damage": { "filters": { "other_with_families": "marlar" } },
							"deals_damage": false
						}
					]
				}
			},
			"armor": {
				"minecraft:equipment": {
				"table": "loot_tables/entities/marlar_herald_gear.json"
				}
			},
			"minecraft:is_dead": {
				"minecraft:transformation": {
					"preserve_equipment": true,
					"into": "zalcyan:marlar_herald_dead"
				}
			},
			"melee_attack": {
				"minecraft:behavior.delayed_attack": {
				"priority": 1,
					"attack_duration": 0.70,
					"attack_once": false,
					"cooldown_time": 0,
					"track_target": true,
					"require_complete_path": false,
					"random_stop_interval": 0,
					"reach_multiplier": 3.0,
					"speed_multiplier": 1.1,
					"hit_delay_pct": 0.5
				},
				"minecraft:attack": {
					"damage": 9
				},
				"minecraft:equipment": {
				"table": "loot_tables/entities/marlar_gear_melee.json"
				},
				"minecraft:timer": {
					"looping": true,
					"time": [
						1,
						3
					],
					"time_down_event": {
						"event": "shield_block_event",
						"target": "self"
					}
				}
			},
			"ranged_attack1": {
				"minecraft:behavior.ranged_attack": {
				"priority": 3,
				"charge_charged_trigger": 0.05,
				"charge_shoot_trigger": 0.2,
				"target_in_sight_time":1.0,
				"attack_interval_min":0.05,
				"attack_interval_max":0.1,
				"attack_radius": 24.0
				},
				"minecraft:shooter": {
					"def": "zalcyan:r_orb"
				},
				"minecraft:equipment": {
				"table": "loot_tables/entities/marlar_gear_ranged.json"
				},
				"minecraft:timer": {
					"looping": true,
					"time": [
						4.8,
						5.5
					],
					"time_down_event": {
						"event": "switch_ranged2",
						"target": "self",
						"filters":{
					"all_of": [
					{ 
					"test": "has_target", 
					"subject": "self", 
					"operator": "equals", 
					"value": true 
					}
					]
				}
					}
				}
			},
			"ranged_attack2": {
				"minecraft:behavior.ranged_attack": {
				"priority": 3,
				"attack_radius": 24.0,
				"swing": true,
				"target_in_sight_time":0.0,
				"attack_interval_min":0.4,
				"attack_interval_max":0.4
				},
				"minecraft:shooter": {
					"def": "zalcyan:smoke_orb"
				},
				"minecraft:equipment": {
				"table": "loot_tables/entities/marlar_gear_throw.json"
				},
				"minecraft:timer": {
					"looping": true,
					"time": 0.75,
					"time_down_event": {
						"event": "switch_ranged1",
						"target": "self"
					}
				}
			},
			"marlar_angry": {
				"minecraft:angry": {
					"duration": 25,
					"broadcast_anger": true,
					"broadcast_anger_on_attack": true,
					"broadcast_anger_on_being_attacked": true,
					"broadcast_range": 16,
					"broadcast_targets": [
						"marlar"
					],
					"calm_event": {
						"event": "minecraft:on_calm",
						"target": "self"
					},
					"filters": {
						"all_of": [
							{
								"test": "has_equipment",
								"value": "zalcyan:zorkan_crown",
								"subject": "other",
								"domain": "head",
								"operator": "not"
							}
						]
					},
					"angry_sound": "angry",
					"sound_interval": {
						"range_min": 2,
						"range_max": 5
					}
				}
			},
			"marlar_calm": {
				"minecraft:on_target_acquired": {
					"event": "minecraft:become_angry",
					"target": "self"
				}
			},
			"bridge:execute_command_id_1": {
				"minecraft:skin_id": {
					"value": 1
				}
			},
			"bridge:execute_no_command": {
				"minecraft:skin_id": {
					"value": 0
				}
			}
		},
		"components": {
        "minecraft:celebrate_hunt": {
          "celebration_targets": {
            "all_of": [
              {
                "test": "is_family",
                "value": "player"
              }
            ]
          },
          "broadcast": true,
          "duration": 4,
          "celebrate_sound": "celebrate",
          "sound_interval": {
            "range_min": 2.0,
            "range_max": 3.0
          },
          "radius": 16
        },
			"minecraft:behavior.pickup_items":{
			"priority": 1,
			"can_pickup_any_item":true,
			"can_pickup_to_hand_or_equipment": true,
			"goal_radius": 2.5,
			"max_dist": 2.0,
			"speed_multiplayer": 1.0,
			"track_target": true
			},
			"minecraft:experience_reward": {
				"on_death": "query.last_hit_by_player ? 5 + (query.equipment_count * Math.Random(1,3)) : 0"
			},
			"minecraft:equip_item": {},
			"minecraft:collision_box": {
				"width": 0.6,
				"height": 1.9
			},
			"minecraft:type_family": {
				"family": [
					"marlar"
				]
			},
			"minecraft:breathable": {
				"total_supply": 15,
				"suffocate_time": 5,
				"breathes_water": false
			},
			"minecraft:health": {
				"value": 20,
				"max": 20
			},
			"minecraft:hurt_on_condition": {
				"damage_conditions": [
					{
						"filters": {
							"test": "in_lava",
							"subject": "self",
							"operator": "==",
							"value": true
						},
						"cause": "lava",
						"damage_per_tick": 4
					}
				]
			},
			"minecraft:loot": {
				"table": "loot_tables/marlar_herald.json"
			},
			"minecraft:movement": {
				"value": 0.36
			},
			"minecraft:navigation.walk": {
				"is_amphibious": false,
				"can_pass_doors": true,
				"can_open_doors": true,
				"avoid_water": true
			},
			 "minecraft:annotation.open_door": {
			},
			"minecraft:movement.basic": {},
			"minecraft:jump.static": {},
			"minecraft:can_climb": {},
			"minecraft:nameable": {},				
			"minecraft:behavior.hurt_by_target": {
				"priority": 1,
				"entity_types": [
					{
						"filters": {
							"test": "is_family",
							"subject": "other",
							"value": "marlar",
							"operator": "!="
						},
						"max_dist": 16
					}
				]
			},
			"minecraft:behavior.nearest_attackable_target": {
				"priority": 1,
				"entity_types": [
					{
						"filters": {
							"all_of": [
								{
									"test": "is_family",
									"subject": "other",
									"value": "baby_turtle"
								},
								{
									"test": "in_water",
									"subject": "other",
									"operator": "!=",
									"value": true
								}
							]
						}
					},
					{
						"filters": {
							"all_of": [
								{
									"all_of": [
										{
											"test": "is_family",
											"value": "player",
											"subject": "other"
										},
										{
											"test": "has_equipment",
											"value": "zalcyan:zorkan_crown",
											"subject": "other",
											"domain": "head",
											"operator": "not"
										}
									]
								},
								{
									"all_of": [
										{
											"test": "is_family",
											"value": "player",
											"subject": "other"
										},
										{
											"test": "has_equipment",
											"value": "zalcyan:marlar_helmet",
											"subject": "other",
											"domain": "head",
											"operator": "not"
										}
									]
								},
								{
									"all_of": [
										{
											"test": "is_family",
											"value": "player",
											"subject": "other"
										},
										{
											"test": "has_equipment",
											"value": "zalcyan:marlar_herald_helmet",
											"subject": "other",
											"domain": "head",
											"operator": "not"
										}
									]
								},
								{
									"test": "is_sleeping",
									"subject": "self",
									"operator": "==",
									"value": false
								}
							]
						},
						"max_dist": 32,
						"walk_speed_multiplier": 0.9,
						"sprint_speed_multiplier": 1.5,
						"must_see": true
					},
					{
						"filters": {
							"all_of": [
								{
									"test": "is_family",
									"value": "skreepog",
									"subject": "other"
								}
							]
						},
						"max_dist": 32,
						"walk_speed_multiplier": 0.9,
						"sprint_speed_multiplier": 1.5,
						"must_see": true
					},
					{
						"filters": {
							"all_of": [
								{
									"test": "is_family",
									"value": "villager",
									"subject": "other"
								}
							]
						},
						"max_dist": 32,
						"walk_speed_multiplier": 0.9,
						"sprint_speed_multiplier": 1.5,
						"must_see": true
					}
				],
				"must_see": true,
				"reselect_targets": true,
				"must_see_forget_duration": 5
			},
			"minecraft:behavior.equip_item": {
				"priority": 3
			},
			"minecraft:behavior.avoid_mob_type": {
				"priority": 4,
				"entity_types": [
					{
						"filters": {
							"test": "is_family",
							"subject": "other",
							"value": "marlar"
						},
						"max_dist": 6,
						"walk_speed_multiplier": 0.9,
						"sprint_speed_multiplier": 0.9
					}
				]
			},
			"minecraft:behavior.random_stroll": {
				"priority": 6,
				"speed_multiplier": 0.7
			},
			"minecraft:behavior.look_at_player": {
				"priority": 7,
				"look_distance": 100
			},
			"minecraft:behavior.random_look_around": {
				"priority": 8
			},
			"minecraft:physics": {},
			"minecraft:pushable": {
				"is_pushable": true,
				"is_pushable_by_piston": true
			},
			"minecraft:follow_range": {
				"value": 100,
				"max": 100
			},
			"minecraft:target_nearby_sensor": {
				"inside_range": 6,
				"outside_range": 7,
				"on_inside_range": {
					"event": "melee_mode",
					"target": "self"
				},
				"on_outside_range": {
					"event": "ranged_mode",
					"target": "self"
				}
			},
			"minecraft:environment_sensor": {
				"triggers": [
					{
						"filters": {
							"all_of": [
								{
									"test": "is_riding",
									"subject": "self",
									"operator": "=",
									"value": true
								}
							]
						},
						"event": "marlar_rider",
						"target": "other"
					},
					{
						"event": "peace",
						"target": "self",
						"filters": {
							"all_of": [
								{
									"test": "is_family",
									"value": "player",
									"subject": "other"
								},
								{
									"test": "has_equipment",
									"value": "zalcyan:zorkan_crown",
									"subject": "other",
									"domain": "head",
									"operator": "=="
								}
							]
						}
					}
				]
			},
			"minecraft:behavior.find_mount": {
				"start_delay": 1,
				"within_radius": 30,
				"max_failed_attempts": 30,
				"priority": 1,
				"avoid_water": true,
				"target_needed": false,
				"mount_distance": 20
			},
        "minecraft:behavior.nap": {
          "priority": 0,
          "cooldown_min": 5.0,
          "cooldown_max": 20.0,
          "mob_detect_dist": 16.0,
          "mob_detect_height": 6.0,
          "can_nap_filters": {
            "all_of": [
              {
                "test": "in_water",
                "subject": "self",
                "operator": "==",
                "value": false
              },
			  {
                "test": "clock_time",
                "operator": ">=",
                "value": 0.25
              },
			  {
                "test": "clock_time",
                "operator": "<=",
                "value": 0.75
              },
              {
                "test": "on_ground",
                "subject": "self",
                "operator": "==",
                "value": true
              },
              {
                "test": "weather_at_position",
                "subject": "self",
                "operator": "!=",
                "value": "thunderstorm"
              }
            ]
          },
          "wake_mob_exceptions": {
            "any_of": [
              {
                "test": "trusts",
                "subject": "other",
                "operator": "==",
                "value": true
              },
              {
                "test": "is_family",
                "subject": "other",
                "operator": "==",
                "value": "marlar"
              },
              {
                "test": "is_sneaking",
                "subject": "other",
                "operator": "==",
                "value": true
              }
            ]
          }
        },
		"minecraft:shareables": {
				"items": [
					{
						"item": "minecraft:skull:0",
						"want_amount": 1,
						"surplus_amount": 1,
						"priority": 0
					},
					{
						"item": "minecraft:skull:1",
						"want_amount": 1,
						"surplus_amount": 1,
						"priority": 0
					},
					{
						"item": "minecraft:carved_pumpkin",
						"want_amount": 1,
						"surplus_amount": 1,
						"priority": 1
					},
					{
						"item": "minecraft:shield",
						"want_amount": 1,
						"surplus_amount": 0,
						"priority": 0
					}
				]
			},
			"minecraft:knockback_resistance": {
				"value": 0.3
			}
		},
		"events": {
			"switch_ranged1": {
				"set_property": { 
					"zalcyan:throw": false
					},
				"remove": {
					"component_groups": [
						"ranged_attack2"
					]
				},
				"add": {
					"component_groups": [
						"ranged_attack1"
					]
				}
			},
			"switch_ranged2": {
				"filters":{
					"all_of": [
					{ 
					"test": "has_target", 
					"subject": "self", 
					"operator": "equals", 
					"value": true 
					}
					]
				},
				"set_property": { 
					"zalcyan:throw": true
					},
				"remove": {
					"component_groups": [
						"ranged_attack1"
					]
				},
				"add": {
					"component_groups": [
						"ranged_attack2"
					]
				}
			},
			
			"minecraft:event_spawn_dead": {
				"add": {
					"component_groups": [
						"minecraft:is_dead"
					]
				}
			},
			"melee_mode": {
				"set_property": { 
					"zalcyan:throw": false
					},
				"remove": {
					"component_groups": [
						"ranged_attack1",
						"ranged_attack2"
					]
				},
				"add": {
					"component_groups": [
						"melee_attack"
					]
				}
			},
			"ranged_mode": {
				"set_property": { 
					"zalcyan:throw": false
					},
				"remove": {
					"component_groups": [
						"melee_attack",
						"shield_block",
						"ranged_attack2"
					]
				},
				"add": {
					"component_groups": [
						"ranged_attack1",
						"no_shield_block"
					]
				},
					"set_property": { 
					"zalcyan:shielded": false
					}
			},
			"minecraft:entity_spawned": {
				"sequence": [
				{
					"add": {
						"component_groups": [
							"no_shield_block"
						]
					}
				},
				{
					"add": {
						"component_groups": [
							"armor"
						]
					}
				},
				{
					"add": {
						"component_groups": [
							"marlar_calm"
						]
					}
				},
				{
					"set_property": { 
					"zalcyan:shielded": false
					}
				},
				{
					"set_property": { 
					"zalcyan:throw": false
					}
				}
				
			]
			},
			"minecraft:on_calm": {
				"remove": {
					"component_groups": [
						"marlar_angry"
					]
				},
				"add": {
					"component_groups": [
						"marlar_calm"
					]
				}
			},
			"minecraft:become_angry": {
				"remove": {
					"component_groups": [
						"marlar_calm"
					]
				},
				"add": {
					"component_groups": [
						"marlar_angry"
					]
				},

					"set_property": { 
					"zalcyan:throw": false
					}

			},
			"peace": {
				"add": {
					"component_groups": [
						"marlar_calm"
					]
				},
				"remove": {
					"component_groups": [
						"melee_attack",
						"ranged_attack1",
						"ranged_attack2",
						"marlar_angry"
					]
				}
			},
			"interact": {
				"add": {
					"component_groups": [
						"bridge:execute_command_id_1"
					]
				}
			},
			"bridge:remove_command_id_1": {
				"add": {
					"component_groups": [
						"bridge:execute_no_command"
					]
				},
				"remove": {
					"component_groups": [
						"bridge:execute_command_id_1"
					]
				}
			},
			"zalcyan:complete_sheild_summon": {
					"set_property": { 
					"zalcyan:equip_custom_shield": false
					}

			},
			"shield_block_event": {
				"filters":{
					"all_of": [
					{
					"test": "has_equipment",
					"subject": "self",
					"domain": "any",
					"operator": "equals",
					"value": "shield"
					},
					{ 
					"test": "has_target", 
					"subject": "self", 
					"operator": "equals", 
					"value": true 
					}
					]
				},
				"add": {
					"component_groups": [
						"shield_block"
					]
				},
				"remove": {
					"component_groups": [
						"melee_attack",
						"no_shield_block"
					]
				},
					"set_property": { 
					"zalcyan:shielded": true
					}
			},
			"no_shield_block_event": {
				"add": {
					"component_groups": [
						"melee_attack",
						"no_shield_block"
					]
				},
				"remove": {
					"component_groups": [
						"shield_block"
					]
				},
					"set_property": { 
					"zalcyan:shielded": false
					}
			}
			
		}
	}
}